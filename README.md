# Watch Films

Приложение для просмотра фильмов с мониторингом системных ресурсов.

## Установка

```bash
npm install
```

## Установка OpenHardwareMonitor

OpenHardwareMonitor устанавливается автоматически во время `npm install`. Если вам нужно переустановить его вручную, выполните:

```bash
node src/setup/setup-ohm.js
```

## Запуск

```bash
npm start
```

## Зависимости

- OpenHardwareMonitor - для мониторинга температуры CPU и использования памяти (устанавливается автоматически)
- Node.js v14+
- .NET Framework 4.5+ (требуется для работы OpenHardwareMonitor)

## Примечания

Если автоматическая установка OpenHardwareMonitor не работает, вы можете скачать его вручную с [официального сайта](https://openhardwaremonitor.org/downloads/) и распаковать в папку `node_modules/open-hardware-monitor/`.

## Особенности

- Автоматическое открытие фильма на основном мониторе
- Отображение информации о фильме на втором мониторе
- Динамичный фон с кадрами из фильма
- Адаптивный интерфейс с поддержкой логотипов фильмов
- Умная система кэширования для быстрой работы
- Автоматическая блокировка рекламы

## Требования

- Windows с двумя мониторами
- Google Chrome
- Node.js 14.x или выше
- Расширения для блокировки рекламы (опционально)

## Установка и запуск

1. Установите зависимости:

```bash
npm install
```

2. Запустите сервер:

```bash
npm start
```

3. Скопируйте API ключ из консоли:

```
Сервер запущен на http://localhost:3060
API ключ: f8d7e9a3c2b1... (ваш ключ будет здесь)
```

4. Используйте один из способов для просмотра фильма:

### Через HTTP запросы

```bash
# Поиск и запуск фильма
curl -X POST http://localhost:3060/command \
  -H "X-API-KEY: ваш-ключ-из-консоли" \
  -H "Content-Type: application/json" \
  -d '{"command":"searchMovie","name":"Матрица"}'

# Закрыть текущий фильм
curl -X POST http://localhost:3060/command \
  -H "X-API-KEY: ваш-ключ-из-консоли" \
  -H "Content-Type: application/json" \
  -d '{"command":"closeMovie"}'
```

### Через веб-интерфейс

1. Откройте http://localhost:3060 в браузере
2. Введите название фильма в поиск
3. Нажмите "Смотреть"

## Настройка

### Мониторы

По умолчанию приложение настроено на два монитора:

- Основной (фильм): справа
- Второй (информация): слева

Для изменения расположения отредактируйте в config.js:

```javascript
monitors: {
  count: 2,          // Количество мониторов (1 или 2)
  positions: {
    main: 0,         // Позиция основного (0 = справа)
    secondary: -1920 // Позиция второго (-1920 = слева)
  }
}
```

### Kinopoisk API

1. Получите ключ на https://kinopoisk.dev
2. Добавьте его в config.js:

```javascript
kinopoisk: {
  apiKey: "ВАШ_КЛЮЧ";
}
```

## Установка OpenHardwareMonitor

Для корректного мониторинга температуры CPU, необходимо:

1. Скачать [OpenHardwareMonitor](https://openhardwaremonitor.org/downloads/)
2. Распаковать скачанный архив
3. Скопировать файлы из распакованного архива в папку `e:\watch-films\src\lib\OpenHardwareMonitor`
4. Убедиться, что файл `OpenHardwareMonitor.exe` находится в этой папке

При запуске сервера, программа автоматически использует OpenHardwareMonitor для мониторинга температуры.

## API Endpoints

### GET /watch

Страница просмотра фильма через Kinobox плеер.

- Параметры: `id` - ID фильма на Кинопоиске
- Пример: `/watch?id=123456`

### GET /info

Информационная страница с описанием фильма, включает:

- Название и логотип
- Рейтинг и год выпуска
- Жанр и страну
- Краткое описание
- Динамичный фон с кадрами

### POST /command

Управление просмотром фильма. Поддерживаемые команды:

- `searchMovie`: Поиск и запуск фильма
  ```json
  { "command": "searchMovie", "name": "Название фильма" }
  ```
- `closeMovie`: Закрытие всех окон просмотра
  ```json
  { "command": "closeMovie" }
  ```
- `isMovieOpened`: Проверка активного просмотра
  ```json
  { "command": "isMovieOpened" }
  ```

## Авторизация

Все защищенные эндпоинты требуют API ключ в заголовке запроса:

```bash
X-API-KEY: your-secret-api-key-here
```

Ключ настраивается в config.js в параметре server.apiKey.

### Примеры запросов с авторизацией

```bash
# Запуск фильма
curl -X POST http://localhost:3060/command \
  -H "X-API-KEY: your-secret-api-key-here" \
  -H "Content-Type: application/json" \
  -d '{"command":"searchMovie","name":"Матрица"}'

# Получение информации
curl http://localhost:3060/info \
  -H "X-API-KEY: your-secret-api-key-here"
```

## Структура проекта

```
watch-films/
├── src/
│   ├── app/
│   │   ├── controllers/   # Обработчики запросов
│   │   ├── services/      # Сервисы (Kinopoisk, Puppeteer)
│   │   └── views/         # Шаблоны и статические файлы
│   │       ├── assets/    # CSS, JS, изображения
│   │       └── *.ejs      # EJS шаблоны
│   ├── app.js            # Точка входа
│   └── server.js         # Настройки сервера
├── config.js             # Конфигурация
└── package.json          # Зависимости
```

## Дополнительные возможности

### Кэширование

- Автоматическое кэширование данных фильмов
- Кэширование результатов поиска
- Настраиваемое время жизни кэша

### Фоновые изображения

- Автоматическая загрузка кадров из фильма
- Плавные переходы между изображениями
- Адаптивная скорость смены кадров в зависимости от длительности фильма

### Расширения Chrome

- Поддержка AdBlock и AdGuard
- Автоматическое определение путей к расширениям
- Блокировка нежелательной рекламы в плеере
